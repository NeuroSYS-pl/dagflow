"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[569],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return c}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(n),c=o,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6830:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return te},default:function(){return re},frontMatter:function(){return ee},metadata:function(){return ne},toc:function(){return ae}});var a,o,r,i,l,s,d,p,u,m,c,h,f,k,g,N,y,b,v,M,w,C,x,E,z,R,_,T,W,O,A,F,S,j,D,P,I,B,q,H,G,V,L=n(7462),X=n(3366),Z=n(7294),K=n(3905),Q=["title","titleId"];function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Y(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var J=function(e){var t=e.title,n=e.titleId,L=Y(e,Q);return Z.createElement("svg",U({xmlns:"http://www.w3.org/2000/svg",width:1655,height:465,viewBox:"-0.5 -0.5 1655 465","aria-labelledby":n},L),t?Z.createElement("title",{id:n},t):null,a||(a=Z.createElement("defs",null,Z.createElement("style",null,"@import url(https://fonts.googleapis.com/css?family=Roboto);"))),o||(o=Z.createElement("path",{d:"M1106 192h282l20 40-20 40h-282l20-40zM52 192h200l20 40-20 40H52l20-40z",fill:"#ccc",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),r||(r=Z.createElement("circle",{cx:162,cy:232,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all",r:55})),i||(i=Z.createElement("text",{x:161.5,y:249.5,fill:"#333",fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"1")),l||(l=Z.createElement("path",{d:"M262 192h200l20 40-20 40H262l20-40z",fill:"#ccc",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),s||(s=Z.createElement("circle",{cx:372,cy:232,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all",r:55})),d||(d=Z.createElement("text",{x:371.5,y:249.5,fill:"#333",fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"2")),p||(p=Z.createElement("path",{d:"M473 192h200l20 40-20 40H473l20-40z",fill:"#ccc",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),u||(u=Z.createElement("circle",{cx:583,cy:232,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all",r:55})),m||(m=Z.createElement("text",{x:582.5,y:249.5,fill:"#333",fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"3")),c||(c=Z.createElement("path",{d:"M684 192h200l20 40-20 40H684l20-40z",fill:"#ccc",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),h||(h=Z.createElement("circle",{cx:794,cy:232,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all",r:55})),f||(f=Z.createElement("text",{x:793.5,y:249.5,fill:"#333",fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"4")),k||(k=Z.createElement("path",{d:"M896 192h200l20 40-20 40H896l20-40z",fill:"#dae8fc",stroke:"#6c8ebf",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),g||(g=Z.createElement("circle",{cx:1006,cy:232,fill:"#dae8fc",stroke:"#6c8ebf",strokeWidth:4,pointerEvents:"all",r:55})),N||(N=Z.createElement("text",{x:1005.5,y:249.5,fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"5")),y||(y=Z.createElement("rect",{x:12,y:12,width:300,height:100,rx:15,ry:15,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all"})),b||(b=Z.createElement("g",{fill:"#333",fontFamily:"Roboto",textAnchor:"middle",fontSize:32},Z.createElement("text",{x:161.5,y:56.5},"module class"),Z.createElement("text",{x:161.5,y:94.5},"definition"))),v||(v=Z.createElement("path",{d:"M162 177v-65",fill:"none",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})),M||(M=Z.createElement("rect",{x:176.74,y:352,width:390.5,height:100,rx:15,ry:15,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all"})),w||(w=Z.createElement("g",{fill:"#333",fontFamily:"Roboto",textAnchor:"middle",fontSize:32},Z.createElement("text",{x:371.49,y:396.5},"setting params and"),Z.createElement("text",{x:371.49,y:434.5},"dependencies"))),C||(C=Z.createElement("path",{d:"M371.99 352l.01-65M583 177v-65",fill:"none",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})),x||(x=Z.createElement("rect",{x:453,y:12,width:260,height:100,rx:15,ry:15,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all"})),E||(E=Z.createElement("g",{fill:"#333",fontFamily:"Roboto",textAnchor:"middle",fontSize:32},Z.createElement("text",{x:582.5,y:56.5},"building"),Z.createElement("text",{x:582.5,y:94.5},"module"))),z||(z=Z.createElement("rect",{x:664,y:352,width:260,height:100,rx:15,ry:15,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all"})),R||(R=Z.createElement("g",{fill:"#333",fontFamily:"Roboto",textAnchor:"middle",fontSize:32},Z.createElement("text",{x:793.5,y:396.5},"building"),Z.createElement("text",{x:793.5,y:434.5},"pipeline"))),_||(_=Z.createElement("path",{d:"M794 352v-65",fill:"none",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})),T||(T=Z.createElement("rect",{x:871.18,y:12,width:269.62,height:100,rx:15,ry:15,fill:"#dae8fc",stroke:"#6c8ebf",strokeWidth:6,pointerEvents:"all"})),W||(W=Z.createElement("text",{x:1005.49,y:75.5,fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:32},"bootstrap")),O||(O=Z.createElement("rect",{x:1124,y:352,width:260,height:100,rx:15,ry:15,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all"})),A||(A=Z.createElement("g",{fill:"#333",fontFamily:"Roboto",textAnchor:"middle",fontSize:32},Z.createElement("text",{x:1253.5,y:396.5},"module"),Z.createElement("text",{x:1253.5,y:434.5},"runtime"))),F||(F=Z.createElement("path",{d:"M1254 352v-65",fill:"none",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})),S||(S=Z.createElement("path",{d:"M1005.99 112l.01 65",fill:"none",stroke:"#6c8ebf",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})),j||(j=Z.createElement("circle",{cx:1254,cy:232,fill:"#f5f5f5",stroke:"#666",strokeWidth:4,pointerEvents:"all",r:55})),D||(D=Z.createElement("text",{x:1253.5,y:249.5,fill:"#333",fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"6")),P||(P=Z.createElement("path",{d:"M1175.727 332.732l-29.984-51.225 59.354.355-7.485 12.964c61.419 35.46 141.71 11.391 179.33-53.768-45.57 78.93-132.311 114.17-193.73 78.71zM1332.273 131.268l29.984 51.225-59.354-.355 7.485-12.964c-61.419-35.46-141.71-11.391-179.33 53.768 45.57-78.93 132.311-114.17 193.73-78.71z",fill:"#f5f5f5",stroke:"#666",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),I||(I=Z.createElement("path",{d:"M1398 192h200l20 40-20 40h-200l20-40z",fill:"#f8cecc",stroke:"#b85450",strokeWidth:4,strokeMiterlimit:10,pointerEvents:"all"})),B||(B=Z.createElement("circle",{cx:1508,cy:232,fill:"#f8cecc",stroke:"#b85450",strokeWidth:4,pointerEvents:"all",r:55})),q||(q=Z.createElement("text",{x:1507.5,y:249.5,fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:40},"7")),H||(H=Z.createElement("rect",{x:1374,y:12,width:268,height:100,rx:15,ry:15,fill:"#f8cecc",stroke:"#b85450",strokeWidth:6,pointerEvents:"all"})),G||(G=Z.createElement("text",{x:1507.5,y:75.5,fontFamily:"Roboto",fontWeight:"bold",textAnchor:"middle",fontSize:32},"teardown")),V||(V=Z.createElement("path",{d:"M1508 112l-.38 65",fill:"none",stroke:"#b85450",strokeWidth:4,strokeMiterlimit:10,strokeDasharray:"4 8",pointerEvents:"stroke"})))},$=["components"],ee={title:"General outlook",sidebar_position:1},te="General outlook",ne={unversionedId:"modules/module",id:"version-0.1/modules/module",isDocsHomePage:!1,title:"General outlook",description:"Module is the most important element of MAGDA. As mentioned in overview, this library is based on graphs so think of modules as nodes. These nodes should execute a single function. They are connected to other nodes by defining input modules, nodes that the current one depends on, and output modules, nodes that the current one sends its results to.",source:"@site/versioned_docs/version-0.1/modules/module.md",sourceDirName:"modules",slug:"/modules/module",permalink:"/magda/docs/modules/module",editUrl:"https://github.com/NeuroSYS-pl/magda/edit/main/web/versioned_docs/version-0.1/modules/module.md",tags:[],version:"0.1",sidebarPosition:1,frontMatter:{title:"General outlook",sidebar_position:1},sidebar:"version-0.1/tutorialSidebar",previous:{title:"Quick Start \u23f1\ufe0f",permalink:"/magda/docs/quick-start"},next:{title:"Workflow",permalink:"/magda/docs/modules/workflow"}},ae=[{value:"Module types",id:"module-types",children:[]},{value:"Module definition",id:"module-definition",children:[]},{value:"Parameters",id:"parameters",children:[]},{value:"Two states of a <code>Module</code>",id:"two-states-of-a-module",children:[]},{value:"Module bootstrapping",id:"module-bootstrapping",children:[]},{value:"Module teardown",id:"module-teardown",children:[]},{value:"Decorators",id:"decorators",children:[{value:"<code>@finalize</code>",id:"finalize",children:[]},{value:"<code>@accept</code> and <code>@produce</code>",id:"accept-and-produce",children:[]},{value:"<code>@expose</code>",id:"expose",children:[]},{value:"<code>@register</code>",id:"register",children:[]}]},{value:"Modules in config",id:"modules-in-config",children:[]}],oe={toc:ae};function re(e){var t=e.components,n=(0,X.Z)(e,$);return(0,K.kt)("wrapper",(0,L.Z)({},oe,n,{components:t,mdxType:"MDXLayout"}),(0,K.kt)("h1",{id:"general-outlook"},"General outlook"),(0,K.kt)("p",null,(0,K.kt)("inlineCode",{parentName:"p"},"Module")," is the most important element of ",(0,K.kt)("em",{parentName:"p"},"MAGDA"),". As mentioned in ",(0,K.kt)("a",{parentName:"p",href:"/magda/docs/home"},"overview"),", this library is based on graphs so think of modules as nodes. These nodes should execute a single function. They are connected to other nodes by defining input modules, nodes that the current one depends on, and output modules, nodes that the current one sends its results to."),(0,K.kt)("h2",{id:"module-types"},"Module types"),(0,K.kt)("p",null,"There are two types of modules."),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"ModuleRuntime"),","),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"ModuleAggregate"),".")),(0,K.kt)("p",null,(0,K.kt)("inlineCode",{parentName:"p"},"ModuleRuntime")," is designed to execute one function and pass it's results further."),(0,K.kt)("p",null,(0,K.kt)("inlineCode",{parentName:"p"},"ModuleAggregate"),"'s purpose is to collect results generated from previous ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleRuntime"),". Without it there would be no way of storing data between each graph traversal."),(0,K.kt)("h2",{id:"module-definition"},"Module definition"),(0,K.kt)("p",null,"For a class to become a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," of a certain type it's as simple as inheriting from either ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleRuntime")," or ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleAggregate"),"."),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"class ModuleThatIsRuntime(Module.Runtime):\n    pass\n\nclass ModuleThatIsAggregator(Module.Aggregate):\n    pass\n")),(0,K.kt)("p",null,"For convenience purposes the base class ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," has hooks to few classes inside it."),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"ModuleRuntime")," can be accessed through ",(0,K.kt)("inlineCode",{parentName:"li"},"Module.Runtime"),","),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"ModuleAggregate")," through ",(0,K.kt)("inlineCode",{parentName:"li"},"Module.Aggregate"),","),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"ModuleInterface")," through ",(0,K.kt)("inlineCode",{parentName:"li"},"Module.Interface"),".")),(0,K.kt)("p",null,"It's possible to also access result objects via:"),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"Module.Result")," - result object from a single ",(0,K.kt)("inlineCode",{parentName:"li"},"Module")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"Module.ResultSet")," - container for all ",(0,K.kt)("inlineCode",{parentName:"li"},"Module.Result"),"s")),(0,K.kt)("h2",{id:"parameters"},"Parameters"),(0,K.kt)("p",null,"A Module has three ways of accessing data:"),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("p",{parentName:"li"},(0,K.kt)("strong",{parentName:"p"},"Context"),(0,K.kt)("br",null),"designed to allow access to more complex structures and to hold references that you might want to initialize only once and use throughout a pipeline lifecycle, such as a DB connection,")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("p",{parentName:"li"},(0,K.kt)("strong",{parentName:"p"},"Shared parameters"),(0,K.kt)("br",null),"a dictionary that should contain common, shared data that is available and the same in every module,")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("p",{parentName:"li"},(0,K.kt)("strong",{parentName:"p"},"Module parameters"),(0,K.kt)("br",null),"a dictionary as well but every ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," will have its own set of params available only to it."))),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"from magda.pipeline import SequentialPipeline\nfrom magda.module import Module\nfrom magda.decorators import finalize\n\n@finalize\nclass ModuleExample(Module.Runtime):\n    def run(self, data, request, *args, **kwargs):\n        print(self.context) # {'DB': 'DB Connection'}\n        print(self.parameters) # {'module_param': 'module_param_value'}\n        print(self.shared_parameters) # {'shared_param': 'shared_param_value'}\n        print(data) # <magda.module.results.ResultSet>\n        print(request) # request variable\n        return None\n\nbuilder = SequentialPipeline()\nbuilder.add_module(ModuleExample('module_example').set_parameters({'module_param': 'module_param_value'}))\nruntime = builder.build({'DB': 'DB Connection'}, {'shared_param': 'shared_param_value'})\nruntime.run('request variable')\n")),(0,K.kt)("p",null,(0,K.kt)("em",{parentName:"p"},"Context"),", ",(0,K.kt)("em",{parentName:"p"},"shared parameters")," and ",(0,K.kt)("em",{parentName:"p"},"module parameters")," are accessible in every ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," through ",(0,K.kt)("inlineCode",{parentName:"p"},"self.context"),", ",(0,K.kt)("inlineCode",{parentName:"p"},"self.shared_parameters")," and ",(0,K.kt)("inlineCode",{parentName:"p"},"self.parameters")," respectively. They are all set during ",(0,K.kt)("em",{parentName:"p"},"pipeline")," (so consequently during ",(0,K.kt)("em",{parentName:"p"},"module"),") build."),(0,K.kt)("p",null,"Also, a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," has access to data from the previous module's output as well as request data through ",(0,K.kt)("inlineCode",{parentName:"p"},"*args")," and ",(0,K.kt)("inlineCode",{parentName:"p"},"**kwargs"),". Here ",(0,K.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,K.kt)("inlineCode",{parentName:"p"},"request")," has been incorporated into method definition through unpacking operators. These two parameters are always passed, that's why they can be written this way."),(0,K.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,K.kt)("div",{parentName:"div",className:"admonition-heading"},(0,K.kt)("h5",{parentName:"div"},(0,K.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,K.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,K.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Notice")),(0,K.kt)("div",{parentName:"div",className:"admonition-content"},(0,K.kt)("p",{parentName:"div"},"There is a ",(0,K.kt)("inlineCode",{parentName:"p"},"return None")," at the end of a ",(0,K.kt)("inlineCode",{parentName:"p"},"run")," method. It's necessary to always return something from the method, even if it's ",(0,K.kt)("inlineCode",{parentName:"p"},"None"),"."))),(0,K.kt)("h2",{id:"two-states-of-a-module"},"Two states of a ",(0,K.kt)("inlineCode",{parentName:"h2"},"Module")),(0,K.kt)("p",null,"Like pipelines, ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," can be in one of two states. It can either be in a ",(0,K.kt)("em",{parentName:"p"},"builder")," state, or in an ",(0,K.kt)("em",{parentName:"p"},"execution")," state. The first one allows do define how a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," should behave, add parameters, define decorators. The latter one is accessed by calling the ",(0,K.kt)("inlineCode",{parentName:"p"},"build")," method which results in an executable module. The result of building a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," is one of two objects ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Runtime")," or ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Aggregate"),", depending from which one the class inherited."),(0,K.kt)("h2",{id:"module-bootstrapping"},"Module bootstrapping"),(0,K.kt)("p",null,"Modules has a special function ",(0,K.kt)("inlineCode",{parentName:"p"},"bootstrap")," that acts just as a regular booting function. It cannot be invoked manually but is run at the very start ",(0,K.kt)("strong",{parentName:"p"},"after a module is built")," and is run ",(0,K.kt)("strong",{parentName:"p"},"only once")," per module. It's especially useful when initializing data or loading something from disk which is essential for the ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," to work properly, such as stored Neural Network weights."),(0,K.kt)(J,{className:"diagram",width:"75%",mdxType:"Phases"}),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@expose()\n@finalize\nclass ModuleBootstrapedValues(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return self.initial_value * 10\n\n    def bootstrap(self):\n        self.initial_value = 1\n\n@expose()\n@accept(ModuleBootstrapedValues)\n@finalize\nclass ModuleBootstrapedWeights(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return self.weights\n\n    def bootstrap(self):\n        self.weights = self.parameters['nn_weights']\n        # some logic to load actual network\n\nbuilder = SequentialPipeline()\nbuilder.add_module(ModuleBootstrapedValues('module values'))\nbuilder.add_module(\n    ModuleBootstrapedWeights('module weights')\n    .depends_on(builder.get_module('module values'))\n    .set_parameters({'nn_weights': [2, 5, 8]})\n)\nruntime = builder.build()\nprint(runtime.run()) # {'module values': 10, 'module weights': [2, 5, 8]}\n")),(0,K.kt)("p",null,"The first one, ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleBootstrapedValues"),", has an additional ",(0,K.kt)("inlineCode",{parentName:"p"},"self.initial_value")," set during bootstrapping, which is later used to calculate an output. The second ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),", ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleBootstrapedWeights"),", makes use of a parameter passed to it during building phase. Here it's just used to initialize fake ",(0,K.kt)("inlineCode",{parentName:"p"},"self.weights")," but could normally be used to read or initialize proper NN weights."),(0,K.kt)("h2",{id:"module-teardown"},"Module teardown"),(0,K.kt)("p",null,"Next to ",(0,K.kt)("inlineCode",{parentName:"p"},"bootstrap")," function, a module may also have implemented ",(0,K.kt)("inlineCode",{parentName:"p"},"teardown")," function. It is run for each module when ",(0,K.kt)("inlineCode",{parentName:"p"},"Pipeline.close")," method is called and is intended to handle some logic in the end of module's lifecycle. An exemplary usecase is closing a connection to database. "),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@expose()\n@finalize\nclass ModuleTeardown(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return self.initial_value * 10\n\n    def teardown(self):\n        # i.e. close here a DB connection\n")),(0,K.kt)("h2",{id:"decorators"},"Decorators"),(0,K.kt)("p",null,"Multiple decorators were designed to allow for quick definition of most important ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," behaviors."),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@finalize")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@accept")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@produce")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@expose")),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@register"))),(0,K.kt)("p",null,"Generally speaking, the order of decorators doesn't matter, but there is an exception, ",(0,K.kt)("inlineCode",{parentName:"p"},"@finalize")," decorator is a special case."),(0,K.kt)("h3",{id:"finalize"},(0,K.kt)("inlineCode",{parentName:"h3"},"@finalize")),(0,K.kt)("p",null,"This is the most important decorator. It's job is to take a class, which inherits from ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Runtime")," or ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Aggregate")," and convert it to a ",(0,K.kt)("em",{parentName:"p"},"builder")," state, which can be further customized."),(0,K.kt)("p",null,"The code must comply with the following rules:"),(0,K.kt)("ul",null,(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@finalize")," does not take any explicit parameters and is invoked without parentheses ",(0,K.kt)("inlineCode",{parentName:"li"},"()"),", since it works on and references a class directly,"),(0,K.kt)("li",{parentName:"ul"},"when defining multiple decorators, ",(0,K.kt)("strong",{parentName:"li"},(0,K.kt)("inlineCode",{parentName:"strong"},"@finalize")," must always be the last one"),", when multiple decorators are defined above a class, ",(0,K.kt)("strong",{parentName:"li"},"order of other ones does not matter"),","),(0,K.kt)("li",{parentName:"ul"},(0,K.kt)("inlineCode",{parentName:"li"},"@finalize")," is always required, the other ones are not.")),(0,K.kt)("h3",{id:"accept-and-produce"},(0,K.kt)("inlineCode",{parentName:"h3"},"@accept")," and ",(0,K.kt)("inlineCode",{parentName:"h3"},"@produce")),(0,K.kt)("p",null,"The role of ",(0,K.kt)("inlineCode",{parentName:"p"},"@accept")," is to define the allowed input type for a given ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),". Similarly, ",(0,K.kt)("inlineCode",{parentName:"p"},"@produce")," specifies the resulting output type of a class. But while ",(0,K.kt)("inlineCode",{parentName:"p"},"@accept")," can allow an input to be of type ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," or ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Interface"),", ",(0,K.kt)("inlineCode",{parentName:"p"},"@produce")," can create results of type ",(0,K.kt)("inlineCode",{parentName:"p"},"Module.Interface"),"."),(0,K.kt)("p",null,"The main idea behind ",(0,K.kt)("inlineCode",{parentName:"p"},"@produce")," and ",(0,K.kt)("inlineCode",{parentName:"p"},"@accept")," is to allow for a common data interfaces. "),(0,K.kt)("p",null,"The ",(0,K.kt)("inlineCode",{parentName:"p"},"@produce")," signature is as follows:"),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@produce(interface_class: Module.Interface)\n")),(0,K.kt)("p",null,"and ",(0,K.kt)("inlineCode",{parentName:"p"},"@accept")," signature:"),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@accept(*ancestors: Iterable[Module], self=False)\n")),(0,K.kt)("p",null,"A ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," can have multiple different ancestors. Also, the same type of ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," can be chained multiple times and for this the optional parameter ",(0,K.kt)("inlineCode",{parentName:"p"},"self=True")," ought to be used. For more on ",(0,K.kt)("inlineCode",{parentName:"p"},"@accept")," and ",(0,K.kt)("inlineCode",{parentName:"p"},"@produce")," parameters please refer to ",(0,K.kt)("a",{parentName:"p",href:"/magda/docs/modules/workflow"},"Module workflow")," and to ",(0,K.kt)("a",{parentName:"p",href:"/magda/docs/modules/interfaces"},"Interfaces"),"."),(0,K.kt)("h3",{id:"expose"},(0,K.kt)("inlineCode",{parentName:"h3"},"@expose")),(0,K.kt)("p",null,"If it's necessary to keep a given ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),"'s output to be accessed at the end of a pipeline ",(0,K.kt)("inlineCode",{parentName:"p"},"@expose")," decorator should be used. Exposing a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," is a way of keeping it's output in a ",(0,K.kt)("inlineCode",{parentName:"p"},"ResultSet")," under a given name. This can be especially useful for logging purposes or exporting data after each run from a certain point of interest in a graph."),(0,K.kt)("p",null,"The names must be unique throught the pipeline, and if the ",(0,K.kt)("inlineCode",{parentName:"p"},"name")," parameter is not set the name given during the ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," initialization will is used instead."),(0,K.kt)("p",null,(0,K.kt)("strong",{parentName:"p"},"Remember that even though there is no other module after the last one, in order for its result to show up after the pipeline the ",(0,K.kt)("inlineCode",{parentName:"strong"},"Module")," has to be exposed.")),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@expose('important_module')\n@finalize\nclass ExposedModuleNamed(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return 'ExposedModuleNamed output'\n\n@expose()\n@accept(ExposedModuleNamed)\n@finalize\nclass ExposedModule(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return 'ExposedModule output'\n\nbuilder = SequentialPipeline()\nbuilder.add_module(ExposedModuleNamed('module_named'))\nbuilder.add_module(ExposedModule('module_unnamed').depends_on(builder.get_module('module_named')))\nruntime = builder.build()\nprint(runtime.run())  # {'important_module': 'ExposedModuleNamed output', 'module_unnamed': 'ExposedModule output'}\n")),(0,K.kt)("p",null,"Both ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),"'s outputs will be available after the completed graph traversal, but ",(0,K.kt)("inlineCode",{parentName:"p"},"ExposedModuleNamed")," output will be accessible under the name ",(0,K.kt)("inlineCode",{parentName:"p"},"important_module"),", while ",(0,K.kt)("inlineCode",{parentName:"p"},"ExposedModule")," output will be available under ",(0,K.kt)("inlineCode",{parentName:"p"},"module_unnamed"),"."),(0,K.kt)("h3",{id:"register"},(0,K.kt)("inlineCode",{parentName:"h3"},"@register")),(0,K.kt)("p",null,"The ",(0,K.kt)("inlineCode",{parentName:"p"},"@register")," decorator's job is to create a mapping between a given name (a string) and a class which can be then used by ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory"),".\nDecorator ",(0,K.kt)("inlineCode",{parentName:"p"},"@register")," is directly connected to ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory"),", which is used when building a pipeline via config files."),(0,K.kt)("pre",null,(0,K.kt)("code",{parentName:"pre",className:"language-python"},"@register('decorator-register')\n@finalize\nclass ModuleRegisterDecorator(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return 'some value'\n\n@finalize\nclass ModuleRegisterManual(Module.Runtime):\n    def run(self, *args, **kwargs):\n        return 'some more values'\n\nModuleFactory.register('manual-register', ModuleRegisterManual)\n\nprint(ModuleFactory.get('manual-register'))  # <class ModuleRegisterManual.Builder>\nprint(ModuleFactory.get('decorator-register'))  # <class ModuleRegisterDecorator.Builder>\n\nModuleFactory.unregister('decorator-register')\n\nprint(ModuleFactory.get('manual-register'))  # <class ModuleRegisterManual.Builder>\nprint(ModuleFactory.get('decorator-register'))  # KeyError: 'decorator-register'\n")),(0,K.kt)("p",null,"As shown, when unregistering a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," other references are still present but when accessing ",(0,K.kt)("inlineCode",{parentName:"p"},"decorator-register")," class it's no longer available and throws an error. Althought not mandatory, the use of kebab-case for ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," registering is recommended. "),(0,K.kt)("h2",{id:"modules-in-config"},"Modules in config"),(0,K.kt)("p",null,"Even though, in yaml files it's not feasible to create a ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),", it's possible to specify a wanted module, via the ",(0,K.kt)("inlineCode",{parentName:"p"},"type")," parameter.\nIn order to use a class as a ",(0,K.kt)("inlineCode",{parentName:"p"},"type")," it needs to be registered with a ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory"),". "),(0,K.kt)("p",null,(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory")," provides two methods - ",(0,K.kt)("inlineCode",{parentName:"p"},"register")," and ",(0,K.kt)("inlineCode",{parentName:"p"},"unregister"),". The first one can be called via both @register decorator or coded manually, the latter one only via code. The registered name points to an earlier predefined ",(0,K.kt)("inlineCode",{parentName:"p"},"Module"),". "),(0,K.kt)("p",null,"This ",(0,K.kt)("inlineCode",{parentName:"p"},"type")," will be then looked for in ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory")," and a class corresponding to the name will be dynamically built.\nIt's vital to pass a ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory")," class to a ",(0,K.kt)("inlineCode",{parentName:"p"},"ConfigReader.read")," method for it to work properly."),(0,K.kt)("p",null,"For more information on how to work with config files please refer to the ",(0,K.kt)("a",{parentName:"p",href:"/magda/docs/configuration/config-file"},"configuration file documentation page"),"."),(0,K.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,K.kt)("div",{parentName:"div",className:"admonition-heading"},(0,K.kt)("h5",{parentName:"div"},(0,K.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,K.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,K.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Pro Tip")),(0,K.kt)("div",{parentName:"div",className:"admonition-content"},(0,K.kt)("p",{parentName:"div"},"If using a decorator approach it's enough to import all classes annotated with ",(0,K.kt)("inlineCode",{parentName:"p"},"@register"),". The method will be run while importing. If using the manual approach it's necessary to register each ",(0,K.kt)("inlineCode",{parentName:"p"},"Module")," individually with ",(0,K.kt)("inlineCode",{parentName:"p"},"ModuleFactory"),", as shown above."))))}re.isMDXComponent=!0}}]);