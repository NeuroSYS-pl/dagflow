<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">General outlook | MAGDA</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://NeuroSYS-pl.github.io/magda/docs/modules/module/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="0.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-0.1"><meta data-react-helmet="true" property="og:title" content="General outlook | MAGDA"><meta data-react-helmet="true" name="description" content="Module is the most important element of MAGDA. As mentioned in overview, this library is based on graphs so think of modules as nodes. These nodes should execute a single function. They are connected to other nodes by defining input modules, nodes that the current one depends on, and output modules, nodes that the current one sends its results to."><meta data-react-helmet="true" property="og:description" content="Module is the most important element of MAGDA. As mentioned in overview, this library is based on graphs so think of modules as nodes. These nodes should execute a single function. They are connected to other nodes by defining input modules, nodes that the current one depends on, and output modules, nodes that the current one sends its results to."><link data-react-helmet="true" rel="canonical" href="https://NeuroSYS-pl.github.io/magda/docs/modules/module/"><link data-react-helmet="true" rel="alternate" href="https://NeuroSYS-pl.github.io/magda/docs/modules/module/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://NeuroSYS-pl.github.io/magda/docs/modules/module/" hreflang="x-default"><link rel="stylesheet" href="/magda/assets/css/styles.369f8454.css">
<link rel="preload" href="/magda/assets/js/runtime~main.434a9ea3.js" as="script">
<link rel="preload" href="/magda/assets/js/main.be521564.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/magda/"><b class="navbar__title">MAGDA üëß</b></a><a class="navbar__item navbar__link navbar__link--active" href="/magda/docs/home/">Guides</a><a href="https://github.com/NeuroSYS-pl/magda/tree/main/examples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/magda/docs/home/">0.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/magda/docs/next/modules/module/">Next</a></li><li><a aria-current="page" class="dropdown__link navbar__link--active" href="/magda/docs/modules/module/">0.1</a></li></ul></div><a href="https://github.com/NeuroSYS-pl/magda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/magda/docs/home/">What is MAGDA?</a></li><li class="menu__list-item"><a class="menu__link" href="/magda/docs/quick-start/">Quick Start ‚è±Ô∏è</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Modules</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/magda/docs/modules/module/">General outlook</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/magda/docs/modules/workflow/">Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/magda/docs/modules/interfaces/">Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/magda/docs/modules/stateful/">Stateful Modules</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Configuration</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 0.1</span><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>General outlook</h1></header><p><code>Module</code> is the most important element of <em>MAGDA</em>. As mentioned in <a href="/magda/docs/home/">overview</a>, this library is based on graphs so think of modules as nodes. These nodes should execute a single function. They are connected to other nodes by defining input modules, nodes that the current one depends on, and output modules, nodes that the current one sends its results to.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="module-types"></a>Module types<a class="hash-link" href="#module-types" title="Direct link to heading">#</a></h2><p>There are two types of modules.</p><ul><li><code>ModuleRuntime</code>,</li><li><code>ModuleAggregate</code>.</li></ul><p><code>ModuleRuntime</code> is designed to execute one function and pass it&#x27;s results further.</p><p><code>ModuleAggregate</code>&#x27;s purpose is to collect results generated from previous <code>ModuleRuntime</code>. Without it there would be no way of storing data between each graph traversal.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="module-definition"></a>Module definition<a class="hash-link" href="#module-definition" title="Direct link to heading">#</a></h2><p>For a class to become a <code>Module</code> of a certain type it&#x27;s as simple as inheriting from either <code>ModuleRuntime</code> or <code>ModuleAggregate</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleThatIsRuntime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleThatIsAggregator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Aggregate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For convenience purposes the base class <code>Module</code> has hooks to few classes inside it.</p><ul><li><code>ModuleRuntime</code> can be accessed through <code>Module.Runtime</code>,</li><li><code>ModuleAggregate</code> through <code>Module.Aggregate</code>,</li><li><code>ModuleInterface</code> through <code>Module.Interface</code>.</li></ul><p>It&#x27;s possible to also access result objects via:</p><ul><li><code>Module.Result</code> - result object from a single <code>Module</code></li><li><code>Module.ResultSet</code> - container for all <code>Module.Result</code>s</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="parameters"></a>Parameters<a class="hash-link" href="#parameters" title="Direct link to heading">#</a></h2><p>A Module has three ways of accessing data:</p><ul><li><p><strong>Context</strong><br>designed to allow access to more complex structures and to hold references that you might want to initialize only once and use throughout a pipeline lifecycle, such as a DB connection,</p></li><li><p><strong>Shared parameters</strong><br>a dictionary that should contain common, shared data that is available and the same in every module,</p></li><li><p><strong>Module parameters</strong><br>a dictionary as well but every <code>Module</code> will have its own set of params available only to it.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> magda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SequentialPipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> magda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">module </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Module</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> magda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decorators </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> finalize</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleExample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># {&#x27;DB&#x27;: &#x27;DB Connection&#x27;}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># {&#x27;module_param&#x27;: &#x27;module_param_value&#x27;}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shared_parameters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># {&#x27;shared_param&#x27;: &#x27;shared_param_value&#x27;}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;magda.module.results.ResultSet&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># request variable</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SequentialPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleExample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module_example&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_parameters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;module_param&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;module_param_value&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;DB&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DB Connection&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;shared_param&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;shared_param_value&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;request variable&#x27;</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>Context</em>, <em>shared parameters</em> and <em>module parameters</em> are accessible in every <code>Module</code> through <code>self.context</code>, <code>self.shared_parameters</code> and <code>self.parameters</code> respectively. They are all set during <em>pipeline</em> (so consequently during <em>module</em>) build.</p><p>Also, a <code>Module</code> has access to data from the previous module&#x27;s output as well as request data through <code>*args</code> and <code>**kwargs</code>. Here <code>data</code>, and <code>request</code> has been incorporated into method definition through unpacking operators. These two parameters are always passed, that&#x27;s why they can be written this way.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Notice</h5></div><div class="admonition-content"><p>There is a <code>return None</code> at the end of a <code>run</code> method. It&#x27;s necessary to always return something from the method, even if it&#x27;s <code>None</code>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="two-states-of-a-module"></a>Two states of a <code>Module</code><a class="hash-link" href="#two-states-of-a-module" title="Direct link to heading">#</a></h2><p>Like pipelines, <code>Module</code> can be in one of two states. It can either be in a <em>builder</em> state, or in an <em>execution</em> state. The first one allows do define how a <code>Module</code> should behave, add parameters, define decorators. The latter one is accessed by calling the <code>build</code> method which results in an executable module. The result of building a <code>Module</code> is one of two objects <code>Module.Runtime</code> or <code>Module.Aggregate</code>, depending from which one the class inherited.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="module-bootstrapping"></a>Module bootstrapping<a class="hash-link" href="#module-bootstrapping" title="Direct link to heading">#</a></h2><p>Modules has a special function <code>bootstrap</code> that acts just as a regular booting function. It cannot be invoked manually but is run at the very start <strong>after a module is built</strong> and is run <strong>only once</strong> per module. It&#x27;s especially useful when initializing data or loading something from disk which is essential for the <code>Module</code> to work properly, such as stored Neural Network weights.</p><svg xmlns="http://www.w3.org/2000/svg" width="75%" height="465" viewBox="-0.5 -0.5 1655 465" class="diagram"><defs><style>@import url(https://fonts.googleapis.com/css?family=Roboto);</style></defs><path d="M1106 192h282l20 40-20 40h-282l20-40zM52 192h200l20 40-20 40H52l20-40z" fill="#ccc" stroke="#666" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="162" cy="232" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all" r="55"></circle><text x="161.5" y="249.5" fill="#333" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">1</text><path d="M262 192h200l20 40-20 40H262l20-40z" fill="#ccc" stroke="#666" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="372" cy="232" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all" r="55"></circle><text x="371.5" y="249.5" fill="#333" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">2</text><path d="M473 192h200l20 40-20 40H473l20-40z" fill="#ccc" stroke="#666" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="583" cy="232" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all" r="55"></circle><text x="582.5" y="249.5" fill="#333" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">3</text><path d="M684 192h200l20 40-20 40H684l20-40z" fill="#ccc" stroke="#666" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="794" cy="232" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all" r="55"></circle><text x="793.5" y="249.5" fill="#333" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">4</text><path d="M896 192h200l20 40-20 40H896l20-40z" fill="#dae8fc" stroke="#6c8ebf" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="1006" cy="232" fill="#dae8fc" stroke="#6c8ebf" stroke-width="4" pointer-events="all" r="55"></circle><text x="1005.5" y="249.5" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">5</text><rect x="12" y="12" width="300" height="100" rx="15" ry="15" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all"></rect><g fill="#333" font-family="Roboto" text-anchor="middle" font-size="32"><text x="161.5" y="56.5">module class</text><text x="161.5" y="94.5">definition</text></g><path d="M162 177v-65" fill="none" stroke="#666" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path><rect x="176.74" y="352" width="390.5" height="100" rx="15" ry="15" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all"></rect><g fill="#333" font-family="Roboto" text-anchor="middle" font-size="32"><text x="371.49" y="396.5">setting params and</text><text x="371.49" y="434.5">dependencies</text></g><path d="M371.99 352l.01-65M583 177v-65" fill="none" stroke="#666" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path><rect x="453" y="12" width="260" height="100" rx="15" ry="15" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all"></rect><g fill="#333" font-family="Roboto" text-anchor="middle" font-size="32"><text x="582.5" y="56.5">building</text><text x="582.5" y="94.5">module</text></g><rect x="664" y="352" width="260" height="100" rx="15" ry="15" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all"></rect><g fill="#333" font-family="Roboto" text-anchor="middle" font-size="32"><text x="793.5" y="396.5">building</text><text x="793.5" y="434.5">pipeline</text></g><path d="M794 352v-65" fill="none" stroke="#666" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path><rect x="871.18" y="12" width="269.62" height="100" rx="15" ry="15" fill="#dae8fc" stroke="#6c8ebf" stroke-width="6" pointer-events="all"></rect><text x="1005.49" y="75.5" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="32">bootstrap</text><rect x="1124" y="352" width="260" height="100" rx="15" ry="15" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all"></rect><g fill="#333" font-family="Roboto" text-anchor="middle" font-size="32"><text x="1253.5" y="396.5">module</text><text x="1253.5" y="434.5">runtime</text></g><path d="M1254 352v-65" fill="none" stroke="#666" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path><path d="M1005.99 112l.01 65" fill="none" stroke="#6c8ebf" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path><circle cx="1254" cy="232" fill="#f5f5f5" stroke="#666" stroke-width="4" pointer-events="all" r="55"></circle><text x="1253.5" y="249.5" fill="#333" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">6</text><path d="M1175.727 332.732l-29.984-51.225 59.354.355-7.485 12.964c61.419 35.46 141.71 11.391 179.33-53.768-45.57 78.93-132.311 114.17-193.73 78.71zM1332.273 131.268l29.984 51.225-59.354-.355 7.485-12.964c-61.419-35.46-141.71-11.391-179.33 53.768 45.57-78.93 132.311-114.17 193.73-78.71z" fill="#f5f5f5" stroke="#666" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><path d="M1398 192h200l20 40-20 40h-200l20-40z" fill="#f8cecc" stroke="#b85450" stroke-width="4" stroke-miterlimit="10" pointer-events="all"></path><circle cx="1508" cy="232" fill="#f8cecc" stroke="#b85450" stroke-width="4" pointer-events="all" r="55"></circle><text x="1507.5" y="249.5" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="40">7</text><rect x="1374" y="12" width="268" height="100" rx="15" ry="15" fill="#f8cecc" stroke="#b85450" stroke-width="6" pointer-events="all"></rect><text x="1507.5" y="75.5" font-family="Roboto" font-weight="bold" text-anchor="middle" font-size="32">teardown</text><path d="M1508 112l-.38 65" fill="none" stroke="#b85450" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 8" pointer-events="stroke"></path></svg><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@expose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleBootstrapedValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initial_value </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initial_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@expose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleBootstrapedValues</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleBootstrapedWeights</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">weights</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">weights </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;nn_weights&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># some logic to load actual network</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SequentialPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleBootstrapedValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module values&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ModuleBootstrapedWeights</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module weights&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depends_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module values&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_parameters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;nn_weights&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># {&#x27;module values&#x27;: 10, &#x27;module weights&#x27;: [2, 5, 8]}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first one, <code>ModuleBootstrapedValues</code>, has an additional <code>self.initial_value</code> set during bootstrapping, which is later used to calculate an output. The second <code>Module</code>, <code>ModuleBootstrapedWeights</code>, makes use of a parameter passed to it during building phase. Here it&#x27;s just used to initialize fake <code>self.weights</code> but could normally be used to read or initialize proper NN weights.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="module-teardown"></a>Module teardown<a class="hash-link" href="#module-teardown" title="Direct link to heading">#</a></h2><p>Next to <code>bootstrap</code> function, a module may also have implemented <code>teardown</code> function. It is run for each module when <code>Pipeline.close</code> method is called and is intended to handle some logic in the end of module&#x27;s lifecycle. An exemplary usecase is closing a connection to database. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@expose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleTeardown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initial_value </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">teardown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># i.e. close here a DB connection</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="decorators"></a>Decorators<a class="hash-link" href="#decorators" title="Direct link to heading">#</a></h2><p>Multiple decorators were designed to allow for quick definition of most important <code>Module</code> behaviors.</p><ul><li><code>@finalize</code></li><li><code>@accept</code></li><li><code>@produce</code></li><li><code>@expose</code></li><li><code>@register</code></li></ul><p>Generally speaking, the order of decorators doesn&#x27;t matter, but there is an exception, <code>@finalize</code> decorator is a special case.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="finalize"></a><code>@finalize</code><a class="hash-link" href="#finalize" title="Direct link to heading">#</a></h3><p>This is the most important decorator. It&#x27;s job is to take a class, which inherits from <code>Module.Runtime</code> or <code>Module.Aggregate</code> and convert it to a <em>builder</em> state, which can be further customized.</p><p>The code must comply with the following rules:</p><ul><li><code>@finalize</code> does not take any explicit parameters and is invoked without parentheses <code>()</code>, since it works on and references a class directly,</li><li>when defining multiple decorators, <strong><code>@finalize</code> must always be the last one</strong>, when multiple decorators are defined above a class, <strong>order of other ones does not matter</strong>,</li><li><code>@finalize</code> is always required, the other ones are not.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="accept-and-produce"></a><code>@accept</code> and <code>@produce</code><a class="hash-link" href="#accept-and-produce" title="Direct link to heading">#</a></h3><p>The role of <code>@accept</code> is to define the allowed input type for a given <code>Module</code>. Similarly, <code>@produce</code> specifies the resulting output type of a class. But while <code>@accept</code> can allow an input to be of type <code>Module</code> or <code>Module.Interface</code>, <code>@produce</code> can create results of type <code>Module.Interface</code>.</p><p>The main idea behind <code>@produce</code> and <code>@accept</code> is to allow for a common data interfaces. </p><p>The <code>@produce</code> signature is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@produce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">interface_class</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Interface</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and <code>@accept</code> signature:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ancestors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Iterable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A <code>Module</code> can have multiple different ancestors. Also, the same type of <code>Module</code> can be chained multiple times and for this the optional parameter <code>self=True</code> ought to be used. For more on <code>@accept</code> and <code>@produce</code> parameters please refer to <a href="/magda/docs/modules/workflow/">Module workflow</a> and to <a href="/magda/docs/modules/interfaces/">Interfaces</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="expose"></a><code>@expose</code><a class="hash-link" href="#expose" title="Direct link to heading">#</a></h3><p>If it&#x27;s necessary to keep a given <code>Module</code>&#x27;s output to be accessed at the end of a pipeline <code>@expose</code> decorator should be used. Exposing a <code>Module</code> is a way of keeping it&#x27;s output in a <code>ResultSet</code> under a given name. This can be especially useful for logging purposes or exporting data after each run from a certain point of interest in a graph.</p><p>The names must be unique throught the pipeline, and if the <code>name</code> parameter is not set the name given during the <code>Module</code> initialization will is used instead.</p><p><strong>Remember that even though there is no other module after the last one, in order for its result to show up after the pipeline the <code>Module</code> has to be exposed.</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@expose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;important_module&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ExposedModuleNamed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ExposedModuleNamed output&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@expose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ExposedModuleNamed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ExposedModule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ExposedModule output&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SequentialPipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ExposedModuleNamed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module_named&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ExposedModule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module_unnamed&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depends_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;module_named&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># {&#x27;important_module&#x27;: &#x27;ExposedModuleNamed output&#x27;, &#x27;module_unnamed&#x27;: &#x27;ExposedModule output&#x27;}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Both <code>Module</code>&#x27;s outputs will be available after the completed graph traversal, but <code>ExposedModuleNamed</code> output will be accessible under the name <code>important_module</code>, while <code>ExposedModule</code> output will be available under <code>module_unnamed</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="register"></a><code>@register</code><a class="hash-link" href="#register" title="Direct link to heading">#</a></h3><p>The <code>@register</code> decorator&#x27;s job is to create a mapping between a given name (a string) and a class which can be then used by <code>ModuleFactory</code>.
Decorator <code>@register</code> is directly connected to <code>ModuleFactory</code>, which is used when building a pipeline via config files.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;decorator-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleRegisterDecorator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;some value&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@finalize</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ModuleRegisterManual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;some more values&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manual-register&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ModuleRegisterManual</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manual-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;class ModuleRegisterManual.Builder&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;decorator-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;class ModuleRegisterDecorator.Builder&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unregister</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;decorator-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;manual-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;class ModuleRegisterManual.Builder&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModuleFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;decorator-register&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># KeyError: &#x27;decorator-register&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As shown, when unregistering a <code>Module</code> other references are still present but when accessing <code>decorator-register</code> class it&#x27;s no longer available and throws an error. Althought not mandatory, the use of kebab-case for <code>Module</code> registering is recommended. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="modules-in-config"></a>Modules in config<a class="hash-link" href="#modules-in-config" title="Direct link to heading">#</a></h2><p>Even though, in yaml files it&#x27;s not feasible to create a <code>Module</code>, it&#x27;s possible to specify a wanted module, via the <code>type</code> parameter.
In order to use a class as a <code>type</code> it needs to be registered with a <code>ModuleFactory</code>. </p><p><code>ModuleFactory</code> provides two methods - <code>register</code> and <code>unregister</code>. The first one can be called via both @register decorator or coded manually, the latter one only via code. The registered name points to an earlier predefined <code>Module</code>. </p><p>This <code>type</code> will be then looked for in <code>ModuleFactory</code> and a class corresponding to the name will be dynamically built.
It&#x27;s vital to pass a <code>ModuleFactory</code> class to a <code>ConfigReader.read</code> method for it to work properly.</p><p>For more information on how to work with config files please refer to the <a href="/magda/docs/configuration/config-file/">configuration file documentation page</a>.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Pro Tip</h5></div><div class="admonition-content"><p>If using a decorator approach it&#x27;s enough to import all classes annotated with <code>@register</code>. The method will be run while importing. If using the manual approach it&#x27;s necessary to register each <code>Module</code> individually with <code>ModuleFactory</code>, as shown above.</p></div></div></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/NeuroSYS-pl/magda/edit/main/web/versioned_docs/version-0.1/modules/module.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/magda/docs/quick-start/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Quick Start ‚è±Ô∏è</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/magda/docs/modules/workflow/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflow ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#module-types" class="table-of-contents__link">Module types</a></li><li><a href="#module-definition" class="table-of-contents__link">Module definition</a></li><li><a href="#parameters" class="table-of-contents__link">Parameters</a></li><li><a href="#two-states-of-a-module" class="table-of-contents__link">Two states of a <code>Module</code></a></li><li><a href="#module-bootstrapping" class="table-of-contents__link">Module bootstrapping</a></li><li><a href="#module-teardown" class="table-of-contents__link">Module teardown</a></li><li><a href="#decorators" class="table-of-contents__link">Decorators</a><ul><li><a href="#finalize" class="table-of-contents__link"><code>@finalize</code></a></li><li><a href="#accept-and-produce" class="table-of-contents__link"><code>@accept</code> and <code>@produce</code></a></li><li><a href="#expose" class="table-of-contents__link"><code>@expose</code></a></li><li><a href="#register" class="table-of-contents__link"><code>@register</code></a></li></ul></li><li><a href="#modules-in-config" class="table-of-contents__link">Modules in config</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://neurosys.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="https://neurosys.com/wp-content/themes/neurosys/static/images/logo-white.svg" alt="NeuroSYS" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://neurosys.com/wp-content/themes/neurosys/static/images/logo-white.svg" alt="NeuroSYS" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2021 NeuroSYS, Built with Docusaurus.</div></div></div></footer></div>
<script src="/magda/assets/js/runtime~main.434a9ea3.js"></script>
<script src="/magda/assets/js/main.be521564.js"></script>
</body>
</html>